<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Accessibility Report</title>

    <style>
        body {
            margin: 1.5rem;
            font-family: Arial, sans-serif;
            font-size: 10pt;
            line-height: 1.4;
        }

        h1 {
            font-size: 20pt;
            margin-bottom: 0.5rem;
            border-bottom: 2px solid #333;
            padding-bottom: 0.3rem;
        }

        h2 {
            font-size: 14pt;
            margin-top: 1.5rem;
            margin-bottom: 0.5rem;
            page-break-after: avoid;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 1rem;
        }

        th {
            background-color: #333;
            color: white;
            padding: 0.5rem;
            text-align: left;
            font-size: 9pt;
            font-weight: bold;
        }

        td {
            padding: 0.5rem;
            border: 1px solid #ccc;
            vertical-align: top;
            font-size: 9pt;
        }

        tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .info-table td {
            border: 1px solid #ddd;
        }

        .info-table td:first-child {
            font-weight: bold;
            width: 25%;
            background-color: #f0f0f0;
        }

        .summary-table {
            margin-bottom: 1.5rem;
        }

        .summary-table td {
            text-align: center;
            font-weight: bold;
            font-size: 11pt;
        }

        .impact-critical {
            background-color: #fdd !important;
            color: #600;
        }

        .impact-serious {
            background-color: #fed !important;
            color: #800;
        }

        .impact-moderate {
            background-color: #ffe !important;
            color: #840;
        }

        .impact-minor {
            background-color: #ffd !important;
            color: #660;
        }

        .impact-passed {
            background-color: #dfd !important;
            color: #060;
        }

        code {
            background-color: #f5f5f5;
            padding: 0.2rem 0.3rem;
            font-size: 8pt;
            word-break: break-all;
            display: block;
            margin-top: 0.3rem;
        }

        .description {
            color: #555;
            margin-bottom: 0.3rem;
        }

        footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 1px solid #ccc;
            text-align: center;
            font-size: 8pt;
            color: #666;
        }

        .small-text {
            font-size: 8pt;
            color: #666;
        }

        h3 {
            font-size: 12pt;
            margin-top: 1rem;
            margin-bottom: 0.5rem;
            page-break-after: avoid;
        }

        .violation-section {
            margin-top: 2rem;
        }

        .violation-header {
            background-color: #f0f0f0;
            padding: 0.5rem;
            border-left: 4px solid #333;
            margin-bottom: 0.5rem;
        }

        .instance-table {
            margin-bottom: 1.5rem;
        }

        .instance-table th {
            background-color: #666;
        }
    </style>
</head>

<body>
    <h1>Accessibility Report</h1>
    
    <table class="info-table">
        <tr>
            <td>URL</td>
            <td>{{ url }}</td>
        </tr>
        <tr>
            <td>Scanned</td>
            <td>{{ generated_at.strftime("%d-%m-%Y %H:%M:%S %Z") }}</td>
        </tr>
        <tr>
            <td>Tool</td>
            <td>axe-core (WCAG 2.0, 2.1, 2.2 - Levels A, AA, AAA)</td>
        </tr>
    </table>

    <h2>Summary</h2>
    
    <table class="summary-table">
        <tr>
            <th>Total Violations</th>
            <th>Passed</th>
            <th>Incomplete</th>
        </tr>
        <tr>
            <td style="background-color: #fdd !important; color: #600;">{{ violations|length }}</td>
            <td class="impact-passed">{{ passes|length }}</td>
            <td>{{ incomplete|length }}</td>
        </tr>
    </table>

    {% set critical_count = (violations | selectattr('impact', 'equalto', 'critical') | list | length) %}
    {% set serious_count = (violations | selectattr('impact', 'equalto', 'serious') | list | length) %}
    {% set moderate_count = (violations | selectattr('impact', 'equalto', 'moderate') | list | length) %}
    {% set minor_count = (violations | selectattr('impact', 'equalto', 'minor') | list | length) %}


    {% if violations|length == 0 %}
    <p style="color: green; font-weight: bold;">No violations found! âœ“</p>
    {% else %}
    <h2>Violations - Impact</h2>
    <table class="summary-table">
        <tr>
            <th>Critical</th>
            <th>Serious</th>
            <th>Moderate</th>
            <th>Minor</th>
        </tr>
        <tr>
            <td class="impact-critical">{{ critical_count }}</td>
            <td class="impact-serious">{{ serious_count }}</td>
            <td class="impact-moderate">{{ moderate_count }}</td>
            <td class="impact-minor">{{ minor_count }}</td>
        </tr>
    </table>

    <h2>Violations - Summary</h2>
    <table>
        <tr>
            <th style="width: 15%;">Rule ID</th>
            <th style="width: 8%;">Impact</th>
            <th style="width: 30%;">Description</th>
            <th style="width: 10%;">Instances</th>
            <th style="width: 37%;">Affected Elements (Sample)</th>
        </tr>
        {% for violation in violations %}
        <tr>
            <td><strong>{{ violation.id }}</strong></td>
            <td class="impact-{{ violation.impact }}">{{ violation.impact|upper }}</td>
            <td>
                {{ violation.help|e }}
                <div class="small-text" style="margin-top: 0.3rem;">
                    <a href="{{ violation.helpUrl }}" style="color: #0066cc;">Learn more</a>
                </div>
            </td>
            <td style="text-align: center;"><strong>{{ violation.nodes|length }}</strong></td>
            <td>
                {% if violation.nodes|length > 0 %}
                <div class="description">{{ violation.nodes[0].failureSummary }}</div>
                <code>{{ violation.nodes[0].html|e }}</code>
                {% if violation.nodes|length > 1 %}
                <div class="small-text" style="margin-top: 0.3rem;">
                    + {{ violation.nodes|length - 1 }} more instance(s)
                </div>
                {% endif %}
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </table>

    <h2>Violations - Detailed report</h2>
    
    {% for violation in violations %}
    <div class="violation-section">
        <div class="violation-header">
            <h3 style="margin: 0;">{{ loop.index }}. {{ violation.id }} 
                <span style="font-size: 10pt; font-weight: normal;">({{ violation.impact|upper }})</span>
            </h3>
            <p style="margin: 0.3rem 0 0 0; font-size: 9pt;">{{ violation.help|e }}</p>
            <p style="margin: 0.3rem 0 0 0;">
                <a href="{{ violation.helpUrl }}" style="color: #0066cc; font-size: 8pt;">Learn more</a>
            </p>
        </div>

        <table class="instance-table">
            <tr>
                <th style="width: 5%;">#</th>
                <th style="width: 45%;">Affected Element</th>
                <th style="width: 50%;">Failure Summary</th>
            </tr>
            {% for node in violation.nodes %}
            <tr>
                <td style="text-align: center;">{{ loop.index }}</td>
                <td><code>{{ node.html|e }}</code></td>
                <td>{{ node.failureSummary }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>
    {% endfor %}

    {% endif %}

    <footer>
        Team Feams | Innovations in Software Engineering | 2025
    </footer>
</body>

</html>