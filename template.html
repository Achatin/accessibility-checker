<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Accessibility Checker</title>

    <style>
        body {
            margin: 2rem;
            font: 1rem Arial, sans-serif;
            height: 100vh;
        }

        main {
            max-width: 64rem;
            margin-right: auto;
            margin-left: auto;
        }

        h3 {
            margin: 0;
            margin-bottom: 0.4rem;
        }

        p {
            margin: 0;
            margin-bottom: 0.3rem;
        }

        a {
            text-decoration: none;
            color: blue;
            font-weight: 500;
        }

        code {
            background-color: #f3f4f6;
            border-radius: 0.25rem;
            padding: 0.1rem 0.3rem;
            font-size: 0.9rem;
        }

        pre {
            margin: 0;
        }

        .border-box {
            border: 1px solid lightgray;
            border-radius: 0.5rem;
            margin-bottom: 1rem;
            padding: 1rem;
        }

        .impact-critical {
            border-left: 0.5rem solid darkred;
        }

        .impact-serious {
            border-left: 0.5rem solid red;
        }

        .impact-moderate {
            border-left: 0.5rem solid orange;
        }

        .impact-minor {
            border-left: 0.5rem solid yellow;
        }

        .violation-count-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            width: 100%;
        }

        .text-detail {
            color: #4a5565;
        }

        .badge {
            border-radius: 9999px;
            border: 1px solid lightgray;
            padding: 0.2rem 0.6rem;
            font-size: 0.85rem;
            font-weight: 500;
        }

        .badge.secondary {
            background-color: #f3f4f6;
        }

        footer {
            text-align: center;
            padding: 1rem;
            position: relative;
        }
    </style>

    <script>
        // Sort violations based on selected criteria
        document.addEventListener('DOMContentLoaded', () => {
            const select = document.querySelector('select');
            const ul = document.querySelector('ul');

            select.addEventListener('change', () => {
                const criteria = select.value;
                const items = Array.from(ul.children);

                items.sort((a, b) => {
                    const impactOrder = { 'critical': 4, 'serious': 3, 'moderate': 2, 'minor': 1 };

                    const getImpact = (item) => {
                        const impactClass = item.className.match(/impact-(\w+)/);
                        return impactClass ? impactOrder[impactClass[1]] : 0;
                    };

                    const getFrequency = (item) => {
                        const badge = item.querySelector('.badge.secondary');
                        if (badge) {
                            const m = badge.textContent.match(/(\d+)/);
                            if (m) return parseInt(m[1], 10);
                        }
                    };

                    if (criteria === 'alphabetical') {
                        return a.querySelector('h3').textContent.localeCompare(b.querySelector('h3').textContent);
                    } else if (criteria === 'impact') {
                        return getImpact(b) - getImpact(a);
                    } else if (criteria === 'most_instances') {
                        return getFrequency(b) - getFrequency(a);
                    } else if (criteria === 'impact_frequency') {
                        return (getImpact(b) * getFrequency(b)) - (getImpact(a) * getFrequency(a));
                    }
                });

                ul.innerHTML = '';
                items.forEach(item => ul.appendChild(item));
            });
        });
    </script>
</head>

<body>

    {% macro impact_icon(impact) %}
    {% if impact == "critical" %}
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="lucide lucide-octagon-alert-icon lucide-octagon-alert">
        <path d="M12 16h.01" />
        <path d="M12 8v4" />
        <path
            d="M15.312 2a2 2 0 0 1 1.414.586l4.688 4.688A2 2 0 0 1 22 8.688v6.624a2 2 0 0 1-.586 1.414l-4.688 4.688a2 2 0 0 1-1.414.586H8.688a2 2 0 0 1-1.414-.586l-4.688-4.688A2 2 0 0 1 2 15.312V8.688a2 2 0 0 1 .586-1.414l4.688-4.688A2 2 0 0 1 8.688 2z" />
    </svg>
    {% elif impact == "serious" %}
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="lucide lucide-triangle-alert-icon lucide-triangle-alert">
        <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3" />
        <path d="M12 9v4" />
        <path d="M12 17h.01" />
    </svg>
    {% elif impact == "moderate" %}
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
        class="lucide lucide-circle-alert-icon lucide-circle-alert">
        <circle cx="12" cy="12" r="10" />
        <line x1="12" x2="12" y1="8" y2="12" />
        <line x1="12" x2="12.01" y1="16" y2="16" />
    </svg>
    {% elif impact == "minor" %}
    <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor"
        stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="lucide lucide-info-icon lucide-info">
        <circle cx="12" cy="12" r="10" />
        <path d="M12 16v-4" />
        <path d="M12 8h.01" />
    </svg>
    {% endif %}
    {% endmacro %}


    <main>
        <h1>Accessibility Report</h1>
        <p class="text-detail" style="margin-bottom: 2rem;">This accessibility report is generated using
            <strong>axe-core</strong>.
            It evaluates content against <strong>WCAG 2.0, 2.1, and 2.2 success criteria</strong>
            at <strong>Levels A, AA, and AAA</strong>, as well as a set of
            <strong>best practice rules</strong> for common accessibility issues.
            Axe-core can automatically detect many issues and will mark others as
            <em>incomplete</em> when manual review is required.
        </p>

        <div class="border-box" style="display: flex; justify-content: space-between; align-items: center;">
            <div>
                <p><strong>URL:</strong> <code>{{ url }}</code></p>
                <p><strong>Scanned:</strong> <span class="text-detail">{{ generated_at.strftime("%d-%m-%Y %H:%M:%S %Z")
                        }}</span></p>
            </div>
            <div style="display: flex; justify-content: space-between; column-gap: 1rem;">
                <p class="text-detail"><strong>{{ violations|length }}</strong> violations</p>
                <p class="text-detail"><strong>{{ passes|length }}</strong> passed</p>
                <p class="text-detail"><strong>{{ incomplete|length }}</strong> incomplete</p>
            </div>
        </div>

        <div style="display: flex; justify-content: space-between; column-gap: 1rem; margin-bottom: 1.5rem;">

            {% set critical_count = (violations | selectattr('impact', 'equalto', 'critical') | list | length) %}
            {% set serious_count = (violations | selectattr('impact', 'equalto', 'serious') | list | length) %}
            {% set moderate_count = (violations | selectattr('impact', 'equalto', 'moderate') | list | length) %}
            {% set minor_count = (violations | selectattr('impact', 'equalto', 'minor') | list | length) %}

            <div class="border-box violation-count-container">
                <div>
                    <p class="text-detail" style="font-weight: 600; font-size: 1rem; margin-bottom: 0.25rem;">Critical
                    </p>
                    <p style="font-weight: 600; font-size: 2rem;">{{ critical_count }}</p>
                </div>

                {{ impact_icon('critical') }}
            </div>

            <div class="border-box violation-count-container">
                <div>
                    <p class="text-detail" style="font-weight: 600; font-size: 1rem; margin-bottom: 0.25rem;">Serious
                    </p>
                    <p style="font-weight: 600; font-size: 2rem;">{{ serious_count }}</p>
                </div>

                {{ impact_icon('serious') }}
            </div>

            <div class="border-box violation-count-container">
                <div>
                    <p class="text-detail" style="font-weight: 600; font-size: 1rem; margin-bottom: 0.25rem;">Moderate
                    </p>
                    <p style="font-weight: 600; font-size: 2rem;">{{ moderate_count }}</p>
                </div>

                {{ impact_icon('moderate') }}
            </div>

            <div class="border-box violation-count-container">
                <div>
                    <p class="text-detail" style="font-weight: 600; font-size: 1rem; margin-bottom: 0.25rem;">Minor</p>
                    <p style="font-weight: 600; font-size: 2rem;">{{ minor_count }}</p>
                </div>

                {{ impact_icon('minor') }}
            </div>

            <div class="border-box violation-count-container" style="background-color: #eff6ff;">
                <div>
                    <p class="text-detail" style="font-weight: 600; font-size: 1rem; margin-bottom: 0.25rem;">Passed</p>
                    <p style="font-weight: 600; font-size: 2rem;">{{ passes|length }}</p>
                </div>

                <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                    class="lucide lucide-circle-check-icon lucide-circle-check">
                    <circle cx="12" cy="12" r="10" />
                    <path d="m9 12 2 2 4-4" />
                </svg>
            </div>

        </div>

        <!-- Sort select for options: alphabetical, impact, frequency/nodes, impact*frequency -->
        {% if violations|length != 0 %}
        <label htmlFor="sort">Sort by: </label>
        <select id="sort">
            <option value="impact_frequency" selected>Impact * Frequency</option>
            <option value="alphabetical">Alphabetical</option>
            <option value="impact">Impact</option>
            <option value="most_instances">Most instances</option>
        </select>
        {% endif %}

        <ul style="list-style-type: none; padding: 0;">
            {% for violation in violations %}
            <li class="border-box impact-{{ violation.impact }}">
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <h3>{{ violation.id }}</h3>
                    <div style="display: flex; align-items: center; column-gap: 0.5rem;">
                        <div class="badge">{{ violation.impact }}</div>
                        <div class="badge secondary">{{ violation.nodes|length }} instances</div>
                    </div>
                </div>
                <p class="text-detail" style="margin-bottom: 0.6rem;">{{ violation.help|e }}.</p>
                <a href="{{ violation.helpUrl }}" target="_blank" rel="noopener noreferrer">
                    Learn more
                    <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none"
                        stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"
                        class="lucide lucide-square-arrow-out-up-right-icon lucide-square-arrow-out-up-right">
                        <path d="M21 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h6" />
                        <path d="m21 3-9 9" />
                        <path d="M15 3h6v6" />
                    </svg>
                </a>
                <details style="margin-top: 1rem;">
                    <summary>Instances</summary>
                    <ul style="list-style-type: none; padding: 0; margin-top: 0.5rem;">
                        {% for node in violation.nodes %}
                        <li class="border-box" style="margin-bottom: 1rem;">
                            <p class="text-detail" style="margin-bottom: 0.5rem;">{{ node.failureSummary }}</p>

                            <p style="margin-bottom: 0.3rem;"><strong>Affected elements</strong></p>
                            <code>{{ node.html|e }}</code>

                            <ul style="list-style-type: none; padding: 0; margin-top: 1rem;">
                                {% for n in node.any %}
                                <li class="border-box">
                                    <p><strong>{{ n.id }}:</strong> {{ n.message }}</p>
                                </li>
                                {% endfor %}
                            </ul>
                        </li>
                        {% endfor %}
                    </ul>
                </details>
            </li>
            {% endfor %}
        </ul>

        <footer>Team
            Feams | Innovations in
            Software
            Engineering | 2025</footer>
    </main>
</body>

</html>